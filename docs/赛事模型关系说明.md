# 赛事模型关系说明

## 一、模型概述

系统中与赛事相关的核心模型包括：赛事(Tournament)、赛事报名(TournamentRegistration)和比赛记录(MatchRecord)。这些模型之间通过关联关系形成完整的赛事管理体系。

## 二、数据模型关系

### 1. 赛事模型 (Tournament)

赛事是整个比赛系统的核心实体，记录了一场赛事的基本信息。

主要字段：
- `id`: 赛事唯一标识
- `title`: 赛事标题
- `description`: 赛事描述
- `start_time`: 开始时间
- `end_time`: 结束时间
- `location`: 比赛地点
- `max_players`: 最大参与人数
- `current_players`: 当前参与人数
- `status`: 赛事状态（草稿/报名中/进行中/已结束）
- `type`: 比赛类型（单打/双打/团体）
- `level`: 赛事级别
- `entry_fee`: 报名费用
- `created_by`: 创建人ID
- `created_at`: 创建时间
- `updated_at`: 更新时间

### 2. 赛事报名模型 (TournamentRegistration)

记录用户报名参加赛事的信息，建立了用户与赛事之间的关联。

主要字段：
- `id`: 报名记录ID
- `tournament_id`: 关联的赛事ID
- `user_id`: 报名用户ID
- `status`: 报名状态（待审核/已通过/已拒绝）
- `payment_status`: 支付状态（未支付/已支付/已退款）
- `created_at`: 报名时间
- `updated_at`: 更新时间

### 3. 比赛记录模型 (MatchRecord)

记录具体比赛的详细信息，包括参赛选手、比分等。

主要字段：
- `id`: 比赛记录ID
- `tournament_id`: 关联的赛事ID
- `player1_id`: 选手1 ID
- `player2_id`: 选手2 ID
- `player1_score`: 选手1得分
- `player2_score`: 选手2得分
- `winner_id`: 获胜者ID
- `status`: 比赛状态（待开始/进行中/已结束）
- `start_time`: 开始时间
- `end_time`: 结束时间
- `round`: 比赛轮次
- `court_number`: 场地编号
- `referee_id`: 裁判ID
- `created_at`: 创建时间
- `updated_at`: 更新时间

## 三、关联关系

1. 赛事与报名关系：
   - 一个赛事可以有多个报名记录（一对多）
   - 每个报名记录必须关联到一个赛事（多对一）
   - 通过 `tournament_id` 建立关联

2. 赛事与比赛记录关系：
   - 一个赛事包含多个比赛记录（一对多）
   - 每个比赛记录属于一个赛事（多对一）
   - 通过 `tournament_id` 建立关联

3. 用户与赛事的关系：
   - 用户可以创建多个赛事（通过 `created_by`）
   - 用户可以报名参加多个赛事（通过 `TournamentRegistration`）
   - 用户可以作为选手参加多场比赛（通过 `MatchRecord` 的 `player1_id`/`player2_id`）
   - 用户可以作为裁判执法多场比赛（通过 `MatchRecord` 的 `referee_id`）

## 四、状态流转

### 1. 赛事状态流转
```
草稿(DRAFT) -> 报名中(REGISTERING) -> 进行中(ONGOING) -> 已结束(FINISHED)
```

### 2. 报名状态流转
```
待审核(PENDING) -> 已通过(APPROVED)/已拒绝(REJECTED)
```

### 3. 比赛状态流转
```
待开始(PENDING) -> 进行中(ONGOING) -> 已结束(FINISHED)
```

## 五、权限控制

1. 赛事管理权限：
   - `tournament:view`: 查看赛事信息
   - `tournament:create`: 创建新赛事
   - `tournament:edit`: 编辑赛事信息
   - `tournament:delete`: 删除赛事
   - `tournament:audit`: 审核赛事报名
   - `tournament:register`: 报名参加赛事

2. 比赛记录权限：
   - `match:view`: 查看比赛记录
   - `match:score`: 记录比赛比分
   - `match:edit`: 编辑比赛信息
   - `match:finish`: 结束比赛

## 六、业务规则

1. 赛事报名规则：
   - 只能在报名中状态下进行报名
   - 当前参与人数不能超过最大参与人数
   - 同一用户不能重复报名同一赛事
   - 报名需要按照赛事要求支付报名费用

2. 比赛记录规则：
   - 只能为进行中的赛事创建比赛记录
   - 比赛结束时必须有一个获胜者
   - 裁判必须具有裁判员角色
   - 参赛选手必须是已报名并审核通过的用户

3. 积分规则：
   - 参与比赛可获得基础积分
   - 获胜可获得额外积分
   - 不同级别赛事的积分权重不同
   - 积分影响用户等级 